//! MAC vendor lookup - Extended OUI database
//! Keep sensor lightweight, do IP enrichment in wifake

use pnet::util::MacAddr;

/// Extended OUI vendor lookup - common vendors
pub fn lookup_vendor(mac: &MacAddr) -> Option<String> {
    let oui = ((mac.0 as u32) << 16) | ((mac.1 as u32) << 8) | (mac.2 as u32);

    match oui {
        // Apple
        0x001B63 | 0x002332 | 0x002436 | 0x002500 | 0x0025BC |
        0x003065 | 0x003EE1 | 0x0050E4 | 0x006171 | 0x0088B4 |
        0x00A040 | 0x00B362 | 0x00C610 | 0x00CDFE | 0x00F4B9 |
        0x041E64 | 0x04489A | 0x044BED | 0x0452F3 | 0x04D3CF |
        0x080007 | 0x10417F | 0x109ADD | 0x14109F | 0x18AF8F |
        0x1C36BB | 0x20A2E4 | 0x24A074 | 0x283737 | 0x2C200B |
        0x34159E | 0x38C986 | 0x3C0754 | 0x403004 | 0x442A60 |
        0x48A195 | 0x4C3275 | 0x503237 | 0x54724F | 0x581FAA |
        0x5C5948 | 0x609217 | 0x64A3CB | 0x680927 | 0x6C4D73 |
        0x70480F | 0x749EAF | 0x78D75F | 0x7C6DF8 | 0x8020AF |
        0x84788B | 0x885395 | 0x8C8590 | 0x9060F1 | 0x9801A7 |
        0x9C207B | 0xA860B6 | 0xAC87A3 | 0xB065BD | 0xB8E856 |
        0xBC5436 | 0xC06394 | 0xC82A14 | 0xCC4463 | 0xD0034B |
        0xD83062 | 0xDC2B2A | 0xE05F45 | 0xE49ADC | 0xE8B2AC |
        0xF0989D | 0xF40F24 | 0xF8E079 => Some("Apple".into()),

        // Raspberry Pi
        0xB827EB | 0xDCA632 | 0xE45F01 | 0xD83ADD | 0x2CCF67 => Some("Raspberry Pi".into()),

        // Samsung
        0x000D6F | 0x0012FB | 0x001599 | 0x001632 | 0x001A8A |
        0x002119 | 0x00265D | 0x08D42B | 0x10D38A | 0x14B484 |
        0x18227E | 0x1C5A3E | 0x2013E0 | 0x28BAB5 | 0x2CAE2B |
        0x3423BA | 0x380A94 | 0x3C5A37 | 0x4844F7 | 0x500F80 |
        0x5440AD | 0x5C0A5B | 0x6C2F2C | 0x748114 | 0x78BD4A |
        0x843835 | 0x8C71F8 | 0x942CB3 | 0x983B16 | 0x9CA3BA |
        0xA0821F | 0xA8F274 | 0xAC5A14 | 0xB47443 | 0xBC14EF |
        0xC44619 | 0xCC07AB | 0xD022BE | 0xDC7144 | 0xE458B8 |
        0xEC1F72 | 0xF025B7 | 0xF44EFD | 0xFCF136 => Some("Samsung".into()),

        // Google
        0x001A11 | 0x3C5AB4 | 0x54609A | 0x94EB2C | 0xF4F5D8 |
        0xF4F5E8 | 0x20DF3F => Some("Google".into()),

        // Amazon
        0x00FC8B | 0x0C47C9 | 0x18742E | 0x40B4CD | 0x44650D |
        0x50DCE7 | 0x6837E9 | 0x74C246 | 0x84D6D0 | 0xA002DC |
        0xB47C9C | 0xFC65DE | 0xFCA183 => Some("Amazon".into()),

        // Microsoft / Xbox
        0x001DD8 | 0x0050F2 | 0x28187D | 0x30B49E | 0x485073 |
        0x505627 | 0x60455E | 0x7C1E52 | 0x7C4F7C | 0x9C8E99 |
        0xB4AE2B | 0xC83F26 | 0xD48F33 | 0xDC536C => Some("Microsoft".into()),

        // Intel
        0x001111 | 0x001302 | 0x001500 | 0x0016EA | 0x0016EB |
        0x001B21 | 0x001B77 | 0x001CBF | 0x001DE0 | 0x001E64 |
        0x001E65 | 0x001E67 | 0x001F3B | 0x001F3C | 0x002264 |
        0x0022FA | 0x0024D6 | 0x0024D7 | 0x00270E | 0x003676 |
        0x008CFA | 0x100BA9 | 0x34028B | 0x485B39 | 0x4CEE68 |
        0x5CC5D4 | 0x685D43 | 0x6C8814 | 0x7C5CF8 | 0x889FFA |
        0x8CBEBE | 0x98FA9B | 0xA44E31 | 0xC8D3FF | 0xE8B1FC |
        0xF81654 | 0xF8BC12 => Some("Intel".into()),

        // Cisco
        0x00000C | 0x000142 | 0x000143 | 0x000163 | 0x000164 |
        0x0001C7 | 0x0001C9 | 0x000216 | 0x000217 | 0x000218 |
        0x000219 | 0x00024A | 0x00027D | 0x00027E | 0x0002B9 |
        0x0002BA | 0x0002FC | 0x0002FD | 0x000380 | 0x000396 |
        0x00039F | 0x0003E3 | 0x0003E4 | 0x0003FD | 0x0003FE |
        0x0004C0 | 0x0004DD | 0x000553 | 0x000556 | 0x000557 => Some("Cisco".into()),

        // TP-Link
        0x000AEB | 0x001410 | 0x10FEED | 0x14CF92 | 0x14E6E4 |
        0x1C3BF3 | 0x24698B | 0x30DE4B | 0x3459C8 | 0x503EAA |
        0x5C6373 | 0x64566D | 0x6C5AB5 | 0x78A106 | 0x9C216A |
        0xA42BB0 | 0xAC84C6 | 0xB09575 | 0xC025E9 | 0xEC086B |
        0xF81A67 | 0xF8D111 => Some("TP-Link".into()),

        // Netgear
        0x000FB5 | 0x00146C | 0x001B2F | 0x001E2A | 0x001F33 |
        0x002326 | 0x00268B | 0x008EF2 | 0x100C6B | 0x10DA43 |
        0x204E7F | 0x28C68E | 0x2C3033 | 0x30469A | 0x405D82 |
        0x446D6C | 0x4C60DE | 0x6CB0CE | 0x744401 | 0x80B03D |
        0x84A423 | 0x9C3DCF | 0xA00460 | 0xA040A0 | 0xA42B8C |
        0xB03956 | 0xC03F0E | 0xC43DC7 | 0xC46E1F | 0xCC40D0 |
        0xE0469A | 0xE091F5 | 0xE4F4C6 => Some("Netgear".into()),

        // Ubiquiti
        0x0027AF | 0x002722 | 0x04180F | 0x0418D6 | 0x18E829 |
        0x24A43C | 0x44D9E7 | 0x68D79A | 0x74ACB9 | 0x788A20 |
        0x7C8BCA | 0x802AA8 | 0xB4FBE4 | 0xDC9FDB | 0xE063DA |
        0xF09FC2 | 0xFC3405 | 0xFCECDA => Some("Ubiquiti".into()),

        // Espressif (ESP32/ESP8266)
        0x08F9E0 | 0x10521C | 0x18FE34 | 0x240AC4 | 0x24A160 |
        0x2462AB | 0x2CF432 | 0x3010DE | 0x3C61FA | 0x3C71BF |
        0x4C7525 | 0x5C45D9 | 0x5CCF7F | 0x60019F | 0x60018E |
        0x68C63A | 0x7C9EBD | 0x807D3A | 0x840D8E | 0x8C4B14 |
        0x94B97E | 0x98F4AB | 0xA020A6 | 0xA4CF12 | 0xAC67B2 |
        0xB4E62D | 0xBC8E9C | 0xBCDD1C | 0xC44F33 | 0xC4DD57 |
        0xC8C9A3 | 0xCC50E3 | 0xD8A01D | 0xD8BFC0 | 0xDC4F22 |
        0xE868E7 | 0xE89F6D | 0xEC94CB | 0xECFA8C | 0xF008D1 |
        0xF4CFA2 => Some("Espressif".into()),

        // Realtek
        0x00E04C | 0x00E084 | 0x404A03 | 0x70F96D | 0x74D02B |
        0x7CC2C6 | 0x7CD30A | 0x9C5C8E | 0xD86CE9 | 0xE89D87 => Some("Realtek".into()),

        // VirtualBox / VMware / QEMU
        0x080027 | 0x0A0027 => Some("VirtualBox".into()),
        0x000C29 | 0x005056 | 0x000569 => Some("VMware".into()),
        0x525400 | 0x020000 => Some("QEMU/KVM".into()),

        // Philips Hue
        0x001788 | 0x00178A | 0xECB5FA => Some("Philips Hue".into()),

        // Sonos
        0x000E58 | 0x5CAAFD | 0x7828CA | 0x949452 | 0xB8E937 => Some("Sonos".into()),

        // Ring
        0x18B430 | 0x204C03 | 0x5C5188 | 0xD4E8B2 => Some("Ring".into()),

        // Nest / Google Home
        0x64167F | 0xD8EB46 | 0xF88FCA => Some("Nest/Google Home".into()),

        // Roku
        0x000D4B | 0x204853 | 0x8C499B | 0xAC3A7A | 0xB083FE |
        0xB8A1B4 | 0xC8A2CE | 0xD03466 => Some("Roku".into()),

        // LG
        0x000E91 | 0x0019A1 | 0x001E75 | 0x001FE2 | 0x002483 |
        0x00258D | 0x0026E2 | 0x00AA70 | 0x10F96F | 0x2C54CF |
        0x34FC6F | 0x38B54D | 0x40B0FA | 0x5C5188 | 0x64899A |
        0x64BC0C | 0x6C5C14 | 0x78F882 | 0x88C9D0 | 0x8C3AE3 |
        0xA8CA7B | 0xAC0D1B | 0xB4E62A | 0xBC8CCD | 0xC49A02 |
        0xCC2D8C | 0xD0D0FD | 0xF8A9D0 | 0xF8E43B => Some("LG".into()),

        // Sony
        0x001315 | 0x0013A9 | 0x001A80 | 0x001D0D | 0x001E81 |
        0x001FA7 | 0x002345 | 0x002567 | 0x00E4A6 | 0x0811FC |
        0x28A024 | 0x2C9151 | 0x305A3A | 0x403F8C | 0x543D9E |
        0x58485A | 0x78843C | 0x78E103 | 0x84250A | 0x905A5F |
        0xA881F1 | 0xAC9B0A | 0xB0D09C | 0xF8461C | 0xFC0FE6 => Some("Sony".into()),

        // Dell
        0x001422 | 0x0018FE | 0x001C23 | 0x001E4F | 0x002219 |
        0x0024E8 | 0x0026B9 | 0x10604B | 0x14187D | 0x14B31F |
        0x181DEA | 0x18A99B | 0x18DB4B | 0x1C72C7 | 0x204747 |
        0x245AD9 | 0x28F10E | 0x34E12D | 0x4032DE | 0x44A842 |
        0x484D7E | 0x4C76A5 | 0x508F4C | 0x5254AB | 0x549F35 |
        0x6C2B59 | 0x74867A | 0x782BCB | 0x843835 | 0x8CDCD4 |
        0x9452FA | 0x984FEE | 0x9CEBE8 | 0xB083FE | 0xB4E10F |
        0xBC305B | 0xD481D7 | 0xDCAE9F | 0xE4B97A | 0xE8B4C8 |
        0xEC7D9D | 0xF0798A | 0xF48E38 | 0xF8B156 | 0xF8BC12 => Some("Dell".into()),

        // HP
        0x000423 | 0x00080D | 0x000D9D | 0x00110A | 0x001321 |
        0x001560 | 0x0016B9 | 0x001708 | 0x001871 | 0x0019BB |
        0x001A4B | 0x001CC4 | 0x001E0B | 0x001F29 | 0x002128 |
        0x00237D | 0x0024A8 | 0x00259C | 0x0026F1 | 0x002710 |
        0x009C02 | 0x0C5E4C | 0x10604B | 0x143068 | 0x1CC1DE |
        0x2C27D7 | 0x308D99 | 0x30D042 | 0x30E1A1 | 0x38EAA7 |
        0x4431C3 | 0x503F56 | 0x5CB901 | 0x643150 | 0x6CAE8B |
        0x70106F | 0x74D435 | 0x7C7A91 | 0x80A589 | 0x80CE62 |
        0x8434A6 | 0x88B4A6 | 0x8CDCD4 | 0x9457A5 | 0x984FEE |
        0x9C8E99 | 0x9CB654 | 0xA45630 | 0xA4C3F0 | 0xAC162D |
        0xB00594 | 0xB05ADA | 0xB8AF67 | 0xC01885 | 0xC42C03 |
        0xCC3D82 | 0xD07714 | 0xD4EB31 | 0xD890E8 | 0xDC0EA1 |
        0xE0694A | 0xE4115B | 0xEC8EB5 | 0xF0F755 | 0xF8633F |
        0xFC3FDB => Some("HP".into()),

        // Default
        _ => None,
    }
}

/// Check if IP is private
pub fn is_private_ip(ip: std::net::IpAddr) -> bool {
    match ip {
        std::net::IpAddr::V4(v4) => {
            v4.is_private() ||
            v4.is_loopback() ||
            v4.is_link_local() ||
            v4.is_broadcast()
        }
        std::net::IpAddr::V6(v6) => {
            v6.is_loopback() ||
            (v6.segments()[0] & 0xfe00) == 0xfc00 ||  // unique local
            (v6.segments()[0] & 0xffc0) == 0xfe80     // link local
        }
    }
}
